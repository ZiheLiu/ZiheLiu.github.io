---
title: HTTP 协议
date: 2020-03-05 17:55:00
categories:
	- network
tags:
	- network
typora-root-url: ../
---

# 引用

- [你猜一个 TCP 连接上面能发多少个 HTTP 请求](https://zhuanlan.zhihu.com/p/61423830)
- [一文读懂 HTTP/2 特性](https://zhuanlan.zhihu.com/p/26559480)

# HTTP是无状态的 V.S. Connection: keep-alive

- 无状态
  - 指协议对于事务的处理没有记忆的能力，服务器不知道客户端的状态。具体来说，这一次向服务端发送的请求，与同一个客户端上一次发送的请求没有任何联系。
- Connection: keep-alive
  - HTTP的传输层协议是TCP。当一个HTTP请求处理结束后，服务端和客户端之间的TCP连接并不会马上关闭，当一段时间内客户端再次发起HTTP请求时，会使用同一个TCP连接进行通信。
  - keep-alive并不是代表TCP连接会永远存在，而是一定时间范围内的。 #TODO
  - HTTP/1.1出现的，默认是开启的。

# 对同一个服务端的多个HTTP的发送情况

## 使用一个TCP连接，可以同时发送多个HTTP请求吗？

###  http/1.1 无法发送多个，使用多个TCP连接来解决

默认情况下，一个TCP连接，同一时刻只能处理一个HTTP请求，两个请求不能有重叠。

HTTP/1.1中规定了Pipelining，但是只存在于理想情况，实际比较复杂。

> 一个支持持久连接的客户端可以在一个连接中发送多个请求（不需要等待任意请求的响应）。收到请求的服务器必须按照请求收到的顺序发送响应。

流水线的缺点：

1. 一些代理服务器不能正确的处理 HTTP Pipelining。
2. "队头堵塞"（Head-of-line blocking）：如果第一个请求阻塞了，即使后边的请求处理好了，也会被阻塞住。

因此，浏览器默认是关闭的，为了提高并发性能，对于一个服务端会建立多个TCP连接。不过，这个连接数目是有上限的，一般不超过6-8个。

### http/2 Multiplexing

- **帧：**HTTP/2 数据通信的最小单位消息：指 HTTP/2 中逻辑上的 HTTP 消息。例如请求和响应等，消息由一个或多个帧组成。

- **流：**存在于连接中的一个虚拟通道。流可以承载双向消息，每个流都有一个唯一的整数ID。

HTTP/2 采用二进制格式传输数据，而非 HTTP 1.x 的文本格式，二进制协议解析起来更高效。 HTTP / 1 的请求和响应报文，都是由起始行，首部和实体正文（可选）组成，各部分之间以文本换行符分隔。HTTP/2 将请求和响应数据分割为更小的帧，并且它们采用二进制编码。

**HTTP/2 中，同域名下所有通信都在单个连接上完成，该连接可以承载任意数量的双向数据流。**每个数据流都以消息的形式发送，而消息又由一个或多个帧组成。多个帧之间可以乱序发送，根据帧首部的**流标识**可以重新组装。
