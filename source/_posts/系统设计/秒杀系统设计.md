---
title: 秒杀系统设计
date: 2020-03-16 16:19:00
categories:
	- 系统设计
tags:
	- 系统设计
typora-root-url: ../../
---

# 引用

- [01 | 为什么需要消息队列？](https://time.geekbang.org/column/article/109572)
- [Java开发面试：高并发秒杀系统如何设计与优化](https://blog.csdn.net/CSDN_Terence/article/details/77744042)

# 前端

## 客户端流控

在客户端，屏蔽用户高频请求，比如在网页中设置 5s 一次访问限制，可以防止用户过度刷接口。

## 静态资源

活动页面可以静态的元素全部静态化，尽量减少动态元素；通过CDN缓存静态资源，来抗峰值。 

# 中间代理层

使用 DNS + LVS + Nginx 进行网关的负载均衡。

# 后端

## 服务限流

在网关中使用 Redis、消息队列等实现令牌桶限流器。

## 异步处理

风险控制、库存锁定 这两个必要步骤处理完成后，即可回复客户端。（这两步可以通过 RPC 调用，方便进行这两步的扩容）。

然后把消息放入消息队列中，由生成订单、短信通知、更新统计数据 服务订阅消息队列进行异步处理。

![img](/images/d2c1ee3d4478580c0d2a8d80d0e833be-4347306.jpg)

## Redis 缓存

库存锁定可以使用 Redis，而不直接操作数据库。

例如用一个 int 记录库存量 `count`。

- 库存锁定时，把 `count` 减一，如果 `count` 大于等于 0、且把消息写入到消息队列成功（避免 Redis 故障），则库存锁定成功。

## 无状态化

每个服务做成无状态化，即所有状态都保存在数据库、Redis 中，不在本地存储状态。

这样可以方便的进行扩容。

