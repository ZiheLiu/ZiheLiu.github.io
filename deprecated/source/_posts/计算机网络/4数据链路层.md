---
title: 4. 数据链路层
date: 2020-03-05 19:02:00
categories:
	- network
tags:
	- network
typora-root-url: ../../
---

# 引用

- [【计算机网络】你真的理解数据链路层吗？](https://zhuanlan.zhihu.com/p/69554474)

- [理解字节填充和零比特填充](https://juejin.im/post/5e64c6136fb9a07cc97daade)

- [TCP/IP详解--数据链路层 & 以太网帧格式](https://blog.csdn.net/yusiguyuan/article/details/22785927)

- [滑动窗口协议（数据链路层）](https://blog.csdn.net/ao__ao/article/details/85094401)

- [数据链路层的连续ARQ协议和TCP都采用“滑动窗口”，有什么区别呢](https://sstompkins.wordpress.com/2010/07/09/数据链路层的连续arq协议和tcp都采用“滑动窗口”，/)

- [链路层寻址和ARP](https://www.jianshu.com/p/d51c27ed6803)

# 功能

1. 寻址
   - 将网络层的 IP 转化为 MAC 地址。
2. 链路管理，帧同步
   - 屏蔽不同物理介质。
   - 数据组帧，使网络层针对帧而不是比特。
3. 流量控制
4. 差错控制
   - 纠错码：每个传输的分组带上足够的冗余信息，接收端能发现并自动纠正差错。
   - 检测吗：分组包含能够发现差错的冗余信息，接收端能够发现差错。
5. 透明传输
   - 帧与帧之间使用特殊字符 `0X7E` 界定。
   - 帧内部出现 `0X7E` 需要转义。
     - 字节填充。
       - `0X7E` -> `(0x7D，0x5E)` 
       - `0x7D` -> `(0x7D，0x5D)`
     - 零比特填充
       - `0x7E` 的二进制表示是 `01111110`，因此在每出现5个1时插入一个0。

# 帧格式

![数据链路层-帧格式](/images/数据链路层-帧格式.png)

- 帧首部
  - 目的地址、原地址、类型
- 帧尾部
  - CRC
- 中间数据部分
  - MTU（最大传输大院）：最大长度为 1500 字节。

# 滑动窗口

数据链路层的连续 ARQ 协议使用滑动窗口。

ARQ（Automatic Repeat reQquest），自动请求重传。又称Go-back-N ARQ，意思是当出现差错必须重传时，要回走N个帧，然后在重传。

## 1 位窗口协议

由于发送方在发出一帧后必须等待前一帧的确认到来才能发送下一帧，所以这样的协议使用了停-等式办法。

## 回退 N 协议

允许发送方在阻塞之前发送 w 个帧，而不是一个帧，通过选择合适的 w 值，发送方就可以连续发送帧。

**问题**：当其中一个帧丢失/损坏后，接收方如何处理后续的帧呢？

- 有两种方法。

### 回退 n

接收方只需要简单丢弃所有到达的后续帧，而且针对这些丢弃的帧不必返回确认。

### 选择重传

接收方将收到的坏帧丢弃，但接受并缓存帧后面的所有好帧。

当发送方超时时，它只重传那个最早的未被确认的帧。如果该重传的帧正确到达接收方，接收方就可按序将它缓存的所有帧递交给网络层。

选择重传对应的接收方窗口大于 1，如果窗口很大，则这种方法对数据链路层的内存需求很大。

## 与 TCP 滑动窗口的区别

### 数据链路层采用了可靠的 ARQ 可以重传，为什么在TCP又有可靠传输这一说法

- 有些链路层协议可能没有实现 ARQ。
- ARQ 只能保证数据在数据链路层是可靠的。
  - 例如数据链路 A => B，ARQ 可以保证数据帧从 A 传到 B，但是如果B是路由器的话，当 B 负载太大的话，也许它就在网络层把数据报丢掉了。
  - 对于 A 来说，它已经通过链路层可靠的将数据报发到 B 上，但当网络拥塞的时候，当这个数据包在 B 的等待队列是时候，有可能被 B 丢掉。这时就要靠传输层 TCP 的可靠传输了。

### 这两个协议采用的滑动窗口有啥区别

数据链路层的滑动窗口是“个数固定”的。而 TCP 的滑动窗口是“个数可变”的，可以由接收端设置WIN字段来修改。